# Understanding Kubernetes with Inspektor Gadget MCP Server

## Description
This example demonstrates how to use Inspektor Gadget MCP server to gain insights into Kubernetes clusters.

## Environment
- Kubernetes Cluster: [minikube](https://github.com/kubernetes/minikube)
- Model: [Claude Sonnet 4](https://www.anthropic.com/claude/sonnet)
- MCP Client: [VS Code](https://code.visualstudio.com/docs/copilot/chat/mcp-servers)
- MCP Server: [Inspektor Gadget MCP Server](https://github.com/inspektor-gadget/ig-mcp-server), [Kubernetes MCP Server](https://github.com/Flux159/mcp-server-kubernetes)
- MCP Tools:
    - Inpektor Gagdet MCP server: `is_inspektor_gadget_deployed`, `get-results`, `stop-gadget`, `trace_tcp`, `trace_dns`, `trace_exec`, `trace_open`
    - Kubernetes MCP server: `kubectl_create`, `kubectl_get`
  
![Tools](media/tools.png)

### mcp.json

```json
{
  "servers": {
    "inspektor-gadget": {
      "type": "stdio",
      "command": "ig-mcp-server",
      "args": [
        "-gadget-images=trace_exec,trace_open,trace_tcp,trace_dns,traceloop"
      ]
    },
    "kubernetes": {
      "type": "stdio",
      "command": "npx",
      "args": [
        "mcp-server-kubernetes"
      ]
    }
  }
}
```

## Protocol

#### User:

<details>
  <summary>Prompt</summary>
  Hi, I want to understand what happens behind the scenes in Kubernetes during typical operations. To do this, Iâ€™d like to use Inspektor Gadget to observe real-time activity. Here's the idea:

  - Start a few relevant gadgets
  - Create a simple NGINX deployment.  
  - Observe and analyze the output from the gadgets to understand what happens inside the cluster during deployment.

  Please keep the output concise since I want to document this interaction!
</details>

![Initial Prompt](media/initial-prompt.png)

> **ðŸ’¡ Commentary:** Notice how we donâ€™t specify which gadget to useâ€”AI selects the most appropriate one based on the context. While it could have run the gadgets in the foreground (the default behavior), it chose to run them in the background, which better fits our use case.
> Also, see how we specify the need for concise output, which is important for documentation purposes.

#### AI:

![Initial Plan](media/initial-plan.png)

> **ðŸ’¡ Commentary:** The AI starts by checking if Inspektor Gadget is deployed in the cluster, which is a good first step to ensure that the necessary tools are available for observation.
> Also, it decided to monitor specific aspects around the workload, which is a good approach to focus on relevant data. It probably should have picked trace_open as well, but hey, itâ€™s AIâ€”not a mind reader.

![Gadget Started](media/gadget-run.png)

> **ðŸ’¡ Commentary:** The AI successfully started the gadgets, see how it keeps gadget instance ids in the context, which is useful for later reference.

![Workload Created](media/workload-creation.png)

> **ðŸ’¡ Commentary:** The AI creates a simple NGINX deployment, which is a common workload in Kubernetes. This step is crucial for generating activity that can be observed by the gadgets.

![Gadget Results](media/gadget-results.png)

> **ðŸ’¡ Commentary:** The AI retrieves the results from the gadgets (using the gadget instance IDs), which is where the real insights come from.

![Gadget Stopped](media/gadget-stop.png)

> **ðŸ’¡ Commentary:** Finally, the AI stops the gadgets, which is a good practice to clean up resources after the observation is complete. Isnâ€™t it amazing how it all just magically works?

![Workload Startup](media/workload-startup.png)

> **ðŸ’¡ Commentary:** The NGINX deployment starts up, and the AI can observe the activity generated by the gadgets. See how Inspektor Gadget is able to capture the very first activity of the workload, which is crucial for understanding the startup process.

![Workload Activity](media/workload-activity.png)

> **ðŸ’¡ Commentary:** The AI analyzes the data and provides additional insightsâ€”useful, maybe, but I probably shouldâ€™ve been clearer about what I actually wanted to see. Next time Iâ€™ll try speaking AI-ese.

### User

![Follow-up](media/follow-up.png)

> **ðŸ’¡ Commentary:** You can always ask the AI for more details or follow-up questions to dive deeper into specific aspects of the Kubernetes activity. It even configures filters to keep the output concise and relevant to your question.
Honestly, itâ€™s starting to feel like it knows Kubernetes better than I do.

## Conclusion

This example demonstrates how to use the Inspektor Gadget MCP server to gain insights into Kubernetes clusters by observing real-time activity. The AI leveraged available gadgets to monitor the deployment of a simple NGINX workload, offering valuable visibility into Kubernetes operations.

This interaction highlights how AI can simplify the understanding of complex systems like Kubernetes. You can easily extend this approach to monitor more advanced workloads or specific scenarios in your own cluster. Give it a try and share your feedback!